# 健康仪表盘需求文档

## 核心需求

### 1. 数据收集
- **多渠道输入**: 飞书群聊/私聊 @海思 的信息
- **数据类型**: 食物照片、运动记录、体重、睡眠等
- **自动存储**: 所有信息自动保存到系统

### 2. 数据展示
- **仪表盘**: 网页形式展示健康数据
- **维度**: 饮食、运动、体重、睡眠等趋势
- **周期**: 日/周/月视图

### 3. Apple Watch 接入（关键）

## Apple Watch 数据接入方案

### 方案一：Apple HealthKit API（推荐）

**原理**:
- Apple Watch 数据自动同步到 iPhone 的 Apple Health
- 通过 HealthKit API 读取数据

**实现方式**:
```
用户授权 → HealthKit 读取步数/心率/睡眠 → 后端存储 → 仪表盘展示
```

**优点**:
- ✅ 官方 API，数据最完整
- ✅ 支持步数、心率、睡眠、运动等多种数据
- ✅ 实时同步

**缺点**:
- ❌ 需要用户主动授权
- ❌ 需要 iOS App 或 Shortcut 作为桥梁（服务器无法直接访问 HealthKit）

**解决方案 - iOS Shortcut**:
```
用户运行 Shortcut → 读取 Health 数据 → 发送到我们服务器
```
- 用户设置自动化（每天定时运行）
- Shortcut 读取步数、心率、睡眠
- HTTP POST 到我们的 API

---

### 方案二：第三方健康平台同步

**支持 Apple Watch 的平台**:
1. **Strava**: 运动数据同步
2. **Withings Health Mate**: 体重、血压
3. **MyFitnessPal**: 饮食记录
4. **Garmin Connect**: 运动手表数据

**实现**:
```
Apple Watch → iPhone Health → 第三方App → API → 我们的服务器
```

**优点**:
- ✅ 部分平台有开放 API
- ✅ 数据类型丰富

**缺点**:
- ❌ 需要用户额外安装 App
- ❌ 数据可能有延迟
- ❌ 部分平台 API 限制

---

### 方案三：手动数据录入（备选）

**方式**:
- 用户在飞书/网页手动输入
- 每日体重、运动时长等

**优点**:
- ✅ 简单直接
- ✅ 不需要技术集成

**缺点**:
- ❌ 用户体验差
- ❌ 数据可能不完整

---

## 推荐方案

### 主方案：Apple HealthKit + iOS Shortcut

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Apple Watch    │────▶│  iPhone Health  │────▶│  iOS Shortcut   │
│  (传感器数据)    │     │  (数据汇总)      │     │  (定时触发)     │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                        │ HTTP POST
                                                        ▼
                                               ┌─────────────────┐
                                               │  我们的服务器    │
                                               │  /api/apple-health│
                                               └────────┬────────┘
                                                        │
                                                        ▼
                                               ┌─────────────────┐
                                               │  数据库          │
                                               │  (PostgreSQL)    │
                                               └─────────────────┘
```

### 备选：手动录入 + 第三方平台

当用户无法使用 Shortcut 时，提供：
- 飞书手动输入
- 网页表单录入
- 第三方平台数据导入（Strava、MyFitnessPal）

---

## 下一步行动

1. **等待老程确认方案**
2. **如确认，开始开发**:
   - Code: 后端 API (/api/apple-health)
   - Idea: 创建 iOS Shortcut 配置指南
   - Om: 服务器准备
3. **老程在 iPhone 上配置 Shortcut**
4. **测试数据同步**
